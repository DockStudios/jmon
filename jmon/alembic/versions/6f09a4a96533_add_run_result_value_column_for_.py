"""Add run result value column for performing averages

Revision ID: 6f09a4a96533
Revises: 8dda5bcee9ca
Create Date: 2023-08-17 05:09:27.238167

"""
from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision = '6f09a4a96533'
down_revision = '8dda5bcee9ca'
branch_labels = None
depends_on = None

def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column('run', sa.Column('result_value', sa.Integer(), nullable=True))
    # Iterate through rows, binary encode value and update new field
    c = op.get_bind()
    c.execute("""
        UPDATE public.run SET result_value=1 WHERE status = 'SUCCESS'
    """)
    c.execute("""
        UPDATE public.run SET result_value=0 WHERE status IN ('FAILED', 'TIMEOUT')
    """)
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_column('run', 'result_value')
    # ### end Alembic commands ###
